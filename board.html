<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UGS Weekly Movement Board</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fafafa;
      margin: 0;
    }
    header {
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
      padding: 1rem;
      background: #fff;
      border-bottom: 2px solid #aaa;
    }
    h2 {
      text-align: left;
      margin: 1rem 0 0.5rem 0.5rem;
      font-size: 1.2rem;
      text-transform: uppercase;
    }
    .board-wrapper {
      padding: 0 0.5rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
      background: #fff;
      table-layout: fixed;
    }
    th, td {
      border: 1px solid #333;
      padding: 0.4rem;
      text-align: center;
      font-size: 0.88rem;
      word-wrap: break-word;
    }
    th {
      background: #eee;
      font-weight: bold;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    input {
      width: 95%;
      padding: 0.2rem;
    }

    /* Column widths matching your Word doc */
    th:nth-child(1), td:nth-child(1) { width: 10%; }  /* POSITION */
    th:nth-child(2), td:nth-child(2) { width: 12%; }  /* NAME */
    th:nth-child(3), td:nth-child(3),
    th:nth-child(4), td:nth-child(4),
    th:nth-child(5), td:nth-child(5),
    th:nth-child(6), td:nth-child(6) { width: 8%; }  /* IN/OUT/RDC/ON CALL */
    th:nth-child(n+7), td:nth-child(n+7) { width: 8%; } /* THURS–WED */

    button {
      margin: 0.2rem;
      padding: 0.3rem 0.6rem;
    }

    #pinModal {
      position: fixed;
      top: 0; left: 0; right:0; bottom:0;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
    }
    #pinBox {
      background: white;
      padding: 2rem;
      border-radius: 0.5rem;
      text-align: center;
    }
    #pinBox input {
      padding: 0.4rem;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <header>UGS WEEKLY MOVEMENT BOARD</header>

  <div class="board-wrapper">
    <h2>Main Staff</h2>
    <div id="mainControls" style="display:none;">
      <button onclick="addMainStaff()">+ Add Main Staff</button>
    </div>
    <table id="mainBoard">
      <thead>
        <tr>
          <th>POSITION</th><th>NAME</th><th>IN</th><th>OUT</th><th>RDC</th><th>ON CALL</th>
          <th>THURS</th><th>FRI</th><th>SAT</th><th>SUN</th><th>MON</th><th>TUES</th><th>WED</th>
        </tr>
      </thead>
      <tbody id="mainRows"></tbody>
    </table>

    <h2>LG CESMs</h2>
    <div id="cesmControls" style="display:none;">
      <button onclick="addCesmStaff()">+ Add CESM Staff</button>
    </div>
    <table id="cesmBoard">
      <thead>
        <tr>
          <th>POSITION</th><th>NAME</th><th>IN</th><th>OUT</th><th>RDC</th><th>ON CALL</th>
          <th>THURS</th><th>FRI</th><th>SAT</th><th>SUN</th><th>MON</th><th>TUES</th><th>WED</th>
        </tr>
      </thead>
      <tbody id="cesmRows"></tbody>
    </table>
  </div>

  <!-- PIN Modal -->
  <div id="pinModal">
    <div id="pinBox">
      <p>Enter Edit PIN</p>
      <input type="password" id="pinInput" placeholder="****">
      <button onclick="checkPin()">Submit</button>
    </div>
  </div>

<script>
  // === CONFIG ===
  const BIN_ID = "68d62f7ad0ea881f408b72a5";
  const API_KEY = "$2a$10$oIE7le5VeZzL9sj1TyMKDOipOvLaRbPOy6mlMmFKywMFaE0ORk4ca"; 
  const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`;
  const UPDATE_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
  const PIN = "0563"; 

  let canEdit = false;
  let mainStaff = [];
  let cesmStaff = [];

  // --- Data functions ---
  async function loadData() {
    try {
      const res = await fetch(API_URL, {
        headers: { "X-Master-Key": API_KEY }
      });
      const json = await res.json();
      const data = json.record;

      mainStaff = data.mainStaff || [];
      cesmStaff = data.cesmStaff || [];
      renderAll();
    } catch (err) {
      console.error("Error loading:", err);
    }
  }

  async function saveData() {
    const data = { mainStaff, cesmStaff };
    try {
      await fetch(UPDATE_URL, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": API_KEY
        },
        body: JSON.stringify(data)
      });
    } catch (err) {
      console.error("Error saving:", err);
    }
  }

  // --- Rendering ---
  function renderBoard(data, containerId){
    const tbody = document.getElementById(containerId);
    tbody.innerHTML = "";
    data.forEach((s, i) => {
      let row = document.createElement("tr");
      row.innerHTML = `
        ${cellField(s,i,containerId,"pos")}
        ${cellField(s,i,containerId,"name")}
        ${cellField(s,i,containerId,"in")}
        ${cellField(s,i,containerId,"out")}
        ${cellField(s,i,containerId,"rdc")}
        ${cellField(s,i,containerId,"on")}
        ${cellField(s,i,containerId,"thu")}
        ${cellField(s,i,containerId,"fri")}
        ${cellField(s,i,containerId,"sat")}
        ${cellField(s,i,containerId,"sun")}
        ${cellField(s,i,containerId,"mon")}
        ${cellField(s,i,containerId,"tue")}
        ${cellField(s,i,containerId,"wed")}
        ${deleteCell(containerId,i)}
      `;
      tbody.appendChild(row);
    });
  }

  function cellField(staff,i,containerId,key){
    let val = staff[key] || "";
    if(canEdit){
      return `<td><input value="${val}" 
              oninput="updateValue('${containerId}',${i},'${key}',this.value)"></td>`;
    } else {
      return `<td>${val||"&nbsp;"}</td>`;
    }
  }

  function deleteCell(containerId, i){
    if(canEdit){
      return `<td><button onclick="deleteRow('${containerId}',${i})">✖</button></td>`;
    } else {
      return ""; // no extra cell in view-only mode
    }
  }

  window.updateValue = function(containerId,i,field,val){
    const arr = containerId === "mainRows"? mainStaff: cesmStaff;
    arr[i][field] = val;
    saveData();
  };

  window.deleteRow = function(containerId,i){
    if(confirm("Delete this row?")){
      if(containerId === "mainRows"){
        mainStaff.splice(i,1);
      } else {
        cesmStaff.splice(i,1);
      }
      saveData();
      renderAll();
    }
  };

  function renderAll(){
    renderBoard(mainStaff,"mainRows");
    renderBoard(cesmStaff,"cesmRows");
    document.getElementById("mainControls").style.display = canEdit? "block":"none";
    document.getElementById("cesmControls").style.display = canEdit? "block":"none";
  }

  // --- Add row functions ---
  function makeBlankStaff(){
    return {pos:"", name:"", in:"", out:"", rdc:"", on:"",
      thu:"", fri:"", sat:"", sun:"", mon:"", tue:"", wed:""};
  }

  window.addMainStaff = function(){
    mainStaff.push(makeBlankStaff());
    saveData();
    renderAll();
  };

  window.addCesmStaff = function(){
    cesmStaff.push(makeBlankStaff());
    saveData();
    renderAll();
  };

  // --- PIN ---
  document.body.addEventListener("dblclick",()=>{
    document.getElementById("pinModal").style.display="flex";
  });

  window.checkPin=function(){
    if(document.getElementById("pinInput").value===PIN){
      canEdit=true;
      renderAll();
      document.getElementById("pinModal").style.display="none";
    }else{
      alert("Wrong PIN");
    }
  };

  // auto refresh
  setInterval(loadData,10000);
  loadData();
</script>
</body>
</html>
